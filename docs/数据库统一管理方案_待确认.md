# 数据库统一管理方案 - 待确认事项

> 请在每个问题后标注您的选择或补充说明，确认后我将开始制定详细实施方案。

---

## 问题 1：独立程序的形态

请选择您倾向的架构方案：

| 选项 | 方案名称      | 描述                                                           | 优点                             | 缺点                                |
| :--: | ------------- | -------------------------------------------------------------- | -------------------------------- | ----------------------------------- |
|  A  | 同仓库子模块  | 在 `SolarPrice-Insight` 内新增 `/admin` 路由或独立入口页面 | 共享代码、部署简单、类型自动同步 | 耦合度较高                          |
|  B  | Monorepo 架构 | 使用 pnpm workspace，db-admin 和主应用作为两个独立 package     | 代码复用 + 可独立部署            | 初始配置复杂度增加                  |
|  C  | 独立仓库      | 完全新建一个 Git 仓库作为管理后台                              | 彻底解耦、可独立演进             | 类型/Schema 需手动同步或发布 npm 包 |

**您的选择：** A

**补充说明（可选）：** ____

---

## 问题 2：数据范围

请确认需要纳入统一管理的数据集合：

| 集合名称                  | 当前存储位置          | 数据描述                               | 纳入管理？ |
| ------------------------- | --------------------- | -------------------------------------- | :--------: |
| `tariffs`               | RxDB (IndexedDB)      | 电价数据（省份、月份、分类、价格等）   |     是     |
| `time_configs`          | RxDB (IndexedDB)      | 时段配置库（省份、月份规则、时段类型） |     是     |
| `comprehensive_results` | RxDB (IndexedDB)      | 综合电价计算结果                       |     是     |
| `pvgis_cache`           | RxDB (IndexedDB)      | PVGIS API 响应缓存（加速重复查询）     |     否     |
| 用户偏好设置              | 无（或 localStorage） | 主题、默认省份、界面设置等             |     否     |
| 其他                      | -                     | 请补充...                              |     -     |

**补充说明（可选）：** ____

---

## 问题 3：本地测试技术栈

请选择本地开发/测试阶段的数据库方案：

| 选项 | 方案名称                | 描述                                                                  | 迁移到 Supabase 难度 |
| :--: | ----------------------- | --------------------------------------------------------------------- | :------------------: |
|  A  | 继续使用 RxDB           | 保持现有架构，后续添加 Supabase Replication Plugin 实现云同步         |          低          |
|  B  | Supabase Local (Docker) | 使用 `supabase start` 启动本地 Postgres + Auth + Storage 容器       |   最低（无缝迁移）   |
|  C  | SQLite + Drizzle ORM    | 本地用 SQLite 文件数据库，生产用 Supabase Postgres，通过 ORM 抽象差异 |         中等         |

**您的选择：** __A__

**补充说明（可选）：** 选择方案A后期将部署到supabase__

---

## 问题 4：管理后台功能范围

请勾选管理后台需要支持的功能：

- [X] **数据表浏览**：查看所有集合的数据列表
- [X] **CRUD 操作**：增删改查单条记录
- [X] **批量操作**：批量删除、批量导入
- [X] **数据导出**：导出为 JSON / Excel / CSV
- [X] **数据导入**：从 JSON / Excel 导入
- [X] **数据校验**：Schema 验证、重复检测
- [X] **数据迁移**：版本升级时的数据迁移工具
- [X] **备份恢复**：定时备份、一键恢复
- [X] **操作日志**：记录数据变更历史
- [X] **权限控制**：多用户角色（仅 Supabase 阶段需要）
- [ ] 其他：____

---

## 问题 5：部署与访问方式

管理后台预期的访问方式：

| 选项 | 描述                                       |
| :--: | ------------------------------------------ |
|  A  | 仅本地开发时使用（不部署到线上）           |
|  B  | 与主应用同域部署，通过 `/admin` 路径访问 |
|  C  | 独立域名部署（如 admin.xxx.com）           |

**您的选择：** A

---

## 确认完成后

请在上述问题中填写您的选择，保存文件后告知我，我将：

1. 创建详细的 `implementation_plan.md` 技术方案
2. 拆解为 `task.md` 任务清单
3. 开始逐步实施

---

*文档创建时间：2026-01-03*
